---
date: '2024-12-26 00:00:00'
title: ubuntu20.04源码编译cyber rt 10.0.0
type: post
---

# ubuntu20.04源码编译cyber rt 10.0.0

## 安装 fastdds

apollo 给的环境是一个 docker。third_party 里 fastdds 的 bazel build 直接通过系统路径依赖的 fastdds。

自己的环境中没有，手动安装一下，看文档是说 10.0.0 升级到了 2.x 版本。

参考 fastdds 官网文档安装一下。

[https://fast-dds.docs.eprosima.com/en/latest/installation/binaries/binaries_linux.html](https://fast-dds.docs.eprosima.com/en/latest/installation/binaries/binaries_linux.html)

二进制版本，下载解压，`sudo install.sh`

- 装不上 python3-xmlschema
    - 换成 `pip3 install xmlschema`，然后注释掉脚本里的 python3-xmlschema
- clone foonathan_memory_vendor 报错；手动进入到该文件夹后 build 通过
- cmake 版本不匹配，要求最低 3.20，但是自带的是 3.16。升级麻烦，直接替换了。按照经验大部分人都是随便写个版本，实际根本没用到什么新功能。

编译通过

## cyber rt

把 third_party 里的 fastdds/uuid 依赖加上。

还缺 bvar。

### 安装 bvar

install_pkg_repo.sh 脚本里安装的。

```
# 添加 Apollo 的 GPG 密钥
curl -fsSL https://apollo-pkg-beta.cdn.bcebos.com/neo/beta/key/deb.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/apolloauto.gpg

# 添加 Apollo 的软件源
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/apolloauto.gpg] https://apollo-pkg-beta.cdn.bcebos.com/apollo/core $(. /etc/os-release && echo "$VERSION_CODENAME") main" | sudo tee /etc/apt/sources.list.d/apolloauto.list

sudo apt update
sudo apt-get install bvar
```

装不上，有人提 issue：

https://github.com/ApolloAuto/apollo/issues/15614

这个库里有 deb：

https://github.com/minhanghuang/CyberRT/tree/v10.0.0-rc1

```
sudo dpkg -i xxx.deb
```

不知为何有个这个 define，报了一堆 fastdds 的错，注释掉之后编译通过

![](assets/2024-12-26-ubuntu20.04源码编译cyber%20rt%2010.0.0@cb1fd07a-58cc-4f6d-84cc-474d645d37cb.png)

## 依赖 cyber rt 的代码编译

### workspace

```Starlark
local_repository(
    name = "apollo",
    path = "../apollo",
)

# 添加 apollo 的依赖
load("@apollo//tools:workspace.bzl", "apollo_repositories")
apollo_repositories()
```

报了 -lfastrtps 找不到的问题

在 cyber rt 的库里加了下 -L

![](assets/2024-12-26-ubuntu20.04源码编译cyber%20rt%2010.0.0@1113f42a-1546-4ed5-a6ff-819eafe3821e.png)

## monorepo 中编译

缺了俩环境变量：

```bash
export UBUNTU=“2004”
export PLATFORM=“X86"
```