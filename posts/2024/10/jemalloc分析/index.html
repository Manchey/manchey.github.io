<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  jemalloc 源码分析
  #


https://blog.lfalive.top/2022/02/15/JeMalloc/
https://uncp.github.io/JeMalloc/



https://blog.csdn.net/qq_37517281/article/details/132760960



  jemalloc heap profile
  #


  jemalloc statistic
  #


  配置方法
  #

通过MALLOC_CONF环境变量使能
export MALLOC_CONF=stats_interval:256000000

opt.stats_interval (int64_t) r-
Average interval between statistics outputs, as measured in bytes of allocation activity. The actual interval may be sporadic because decentralized event counters are used to avoid synchronization bottlenecks. The output may be triggered on any thread, which then calls malloc_stats_print(). opt.stats_interval_opts can be combined to specify output options. By default, interval-triggered stats output is disabled (encoded as -1).">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/2024/10/jemalloc%E5%88%86%E6%9E%90/">
  <meta property="og:site_name" content="Manchey Blog">
  <meta property="og:title" content="jemalloc分析">
  <meta property="og:description" content="jemalloc 源码分析 # https://blog.lfalive.top/2022/02/15/JeMalloc/ https://uncp.github.io/JeMalloc/ https://blog.csdn.net/qq_37517281/article/details/132760960 jemalloc heap profile # jemalloc statistic # 配置方法 # 通过MALLOC_CONF环境变量使能
export MALLOC_CONF=stats_interval:256000000
opt.stats_interval (int64_t) r-
Average interval between statistics outputs, as measured in bytes of allocation activity. The actual interval may be sporadic because decentralized event counters are used to avoid synchronization bottlenecks. The output may be triggered on any thread, which then calls malloc_stats_print(). opt.stats_interval_opts can be combined to specify output options. By default, interval-triggered stats output is disabled (encoded as -1).">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-10-11T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-11T00:00:00+00:00">
    <meta property="article:tag" content="Cpp">
    <meta property="article:tag" content="OS">
<title>jemalloc分析 | Manchey Blog</title>
<link rel="icon" href="http://localhost:1313/logo.png" >
<link rel="manifest" href="http://localhost:1313/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/2024/10/jemalloc%E5%88%86%E6%9E%90/">
<link rel="stylesheet" href="http://localhost:1313/book.min.2d11051f9bbf9eb3c1e80b2b7a60b21379d1b88bdcc5a0c2b268ec9357d72f50.css" integrity="sha256-LREFH5u/nrPB6AsremCyE3nRuIvcxaDCsmjsk1fXL1A=" crossorigin="anonymous">
  <script defer src="http://localhost:1313/fuse.min.js"></script>
  <script defer src="http://localhost:1313/en.search.min.cba2a17163d765382a98fdfdb563694e75c6dc9bbdcc43aa5ddd8d7c33b9ef35.js" integrity="sha256-y6KhcWPXZTgqmP39tWNpTnXG3Ju9zEOqXd2NfDO57zU=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="http://localhost:1313/"><img src="http://localhost:1313/logo.png" alt="Logo" class="book-icon" /><span>Manchey Blog</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>























  
<ul>
  
  <li>
    <a href="http://localhost:1313/"  >
        Home
      </a>
  </li>
  
  <li>
    <a href="http://localhost:1313/post/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="http://localhost:1313/about/"  >
        About
      </a>
  </li>
  
  <li>
    <a href="https://github.com/Manchey/manchey.github.io"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="http://localhost:1313/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>jemalloc分析</h3>

  <label for="toc-control">
    
    <img src="http://localhost:1313/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置方法">配置方法</a></li>
    <li><a href="#统计数据">统计数据</a>
      <ul>
        <li><a href="#配置信息">配置信息</a></li>
        <li><a href="#整体情况">整体情况</a></li>
        <li><a href="#arena-statistics">arena statistics</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="jemalloc-源码分析">
  jemalloc 源码分析
  <a class="anchor" href="#jemalloc-%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90">#</a>
</h1>
<ul>
<li><a href="https://blog.lfalive.top/2022/02/15/JeMalloc/">https://blog.lfalive.top/2022/02/15/JeMalloc/</a></li>
<li><a href="https://uncp.github.io/JeMalloc/">https://uncp.github.io/JeMalloc/</a></li>
</ul>
<p><img src="99_work/assets/b152a7d4afd683e75810d68e49371796_MD5.png" alt="1728985022446" /></p>
<ul>
<li><a href="https://blog.csdn.net/qq_37517281/article/details/132760960">https://blog.csdn.net/qq_37517281/article/details/132760960</a></li>
</ul>
<p><img src="99_work/assets/9139744f3f54fa1918e72b2262fcc8e2_MD5.png" alt="1728979610011" title="https://blog.csdn.net/qq_37517281/article/details/132760960"/></p>
<h1 id="jemalloc-heap-profile">
  jemalloc heap profile
  <a class="anchor" href="#jemalloc-heap-profile">#</a>
</h1>
<h1 id="jemalloc-statistic">
  jemalloc statistic
  <a class="anchor" href="#jemalloc-statistic">#</a>
</h1>
<h2 id="配置方法">
  配置方法
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e6%96%b9%e6%b3%95">#</a>
</h2>
<p>通过MALLOC_CONF环境变量使能</p>
<p><code>export MALLOC_CONF=stats_interval:256000000</code></p>
<blockquote>
<p><code>opt.stats_interval</code> (int64_t) <code>r-</code></p>
<p>Average interval between statistics outputs, as measured in bytes of allocation activity. The actual interval may be sporadic because decentralized event counters are used to avoid synchronization bottlenecks. The output may be triggered on any thread, which then calls <code>malloc_stats_print()</code>. <code>opt.stats_interval_opts</code> can be combined to specify output options. By default, interval-triggered stats output is disabled (encoded as -1).</p>
<p><code>opt.stats_interval_opts</code> (const char *) <code>r-</code></p>
<p>Options (the <em><code>opts</code></em> string) to pass to the <code>malloc_stats_print()</code> for interval based statistics printing (enabled through <code>opt.stats_interval</code>). See available options in <code>malloc_stats_print()</code>. Has no effect unless <code>opt.stats_interval</code> is enabled. The default is “”.</p>
</blockquote>
<ul>
<li>stats_interval_opts配置选项</li>
</ul>
<table>
  <thead>
      <tr>
          <th>opts</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>J</td>
          <td>presented in JSON format</td>
      </tr>
      <tr>
          <td>g</td>
          <td>omit general information that never changes during execution</td>
      </tr>
      <tr>
          <td>m</td>
          <td>omit merged arena statistics</td>
      </tr>
      <tr>
          <td>d</td>
          <td>omit destroyed merged arena statistics</td>
      </tr>
      <tr>
          <td>a</td>
          <td>omit per arena statistics</td>
      </tr>
      <tr>
          <td>b</td>
          <td>omit per size class statistics for bins</td>
      </tr>
      <tr>
          <td>l</td>
          <td>omit per size class statistics for large objects</td>
      </tr>
      <tr>
          <td>x</td>
          <td>omit all mutex statistics</td>
      </tr>
      <tr>
          <td>e</td>
          <td>omit extent statistics</td>
      </tr>
  </tbody>
</table>
<h2 id="统计数据">
  统计数据
  <a class="anchor" href="#%e7%bb%9f%e8%ae%a1%e6%95%b0%e6%8d%ae">#</a>
</h2>
<h3 id="配置信息">
  配置信息
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e4%bf%a1%e6%81%af">#</a>
</h3>
<p>general information that never changes during execution</p>
<p>一般来说是不变的。打开g选项可以屏蔽。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Version: &#34;0.0.0-0-g000000missing_version_try_git_fetch_tags&#34;
</span></span><span style="display:flex;"><span>Build-time option settings
</span></span><span style="display:flex;"><span>  config.cache_oblivious: true
</span></span><span style="display:flex;"><span>  config.debug: false
</span></span><span style="display:flex;"><span>  config.fill: true
</span></span><span style="display:flex;"><span>  config.lazy_lock: false
</span></span><span style="display:flex;"><span>  config.malloc_conf: &#34;&#34;
</span></span><span style="display:flex;"><span>  config.opt_safety_checks: false
</span></span><span style="display:flex;"><span>  config.prof: true
</span></span><span style="display:flex;"><span>  config.prof_libgcc: true
</span></span><span style="display:flex;"><span>  config.prof_libunwind: false
</span></span><span style="display:flex;"><span>  config.stats: true
</span></span><span style="display:flex;"><span>  config.utrace: false
</span></span><span style="display:flex;"><span>  config.xmalloc: false
</span></span><span style="display:flex;"><span>Run-time option settings
</span></span><span style="display:flex;"><span>  opt.abort: false
</span></span><span style="display:flex;"><span>  opt.abort_conf: false
</span></span><span style="display:flex;"><span>  opt.cache_oblivious: true
</span></span><span style="display:flex;"><span>  opt.confirm_conf: false
</span></span><span style="display:flex;"><span>  opt.retain: true
</span></span><span style="display:flex;"><span>  opt.dss: &#34;secondary&#34;
</span></span><span style="display:flex;"><span>  opt.narenas: 12
</span></span><span style="display:flex;"><span>  opt.percpu_arena: &#34;disabled&#34;
</span></span><span style="display:flex;"><span>  opt.oversize_threshold: 8388608
</span></span><span style="display:flex;"><span>  opt.hpa: false
</span></span><span style="display:flex;"><span>  opt.hpa_slab_max_alloc: 65536
</span></span><span style="display:flex;"><span>  opt.hpa_hugification_threshold: 1992294
</span></span><span style="display:flex;"><span>  opt.hpa_hugify_delay_ms: 10000
</span></span><span style="display:flex;"><span>  opt.hpa_min_purge_interval_ms: 5000
</span></span><span style="display:flex;"><span>  opt.hpa_dirty_mult: &#34;0.25&#34;
</span></span><span style="display:flex;"><span>  opt.hpa_sec_nshards: 4
</span></span><span style="display:flex;"><span>  opt.hpa_sec_max_alloc: 32768
</span></span><span style="display:flex;"><span>  opt.hpa_sec_max_bytes: 262144
</span></span><span style="display:flex;"><span>  opt.hpa_sec_bytes_after_flush: 131072
</span></span><span style="display:flex;"><span>  opt.hpa_sec_batch_fill_extra: 0
</span></span><span style="display:flex;"><span>  opt.metadata_thp: &#34;auto&#34;
</span></span><span style="display:flex;"><span>  opt.mutex_max_spin: 600
</span></span><span style="display:flex;"><span>  opt.background_thread: false (background_thread: false)
</span></span><span style="display:flex;"><span>  opt.dirty_decay_ms: 20000 (arenas.dirty_decay_ms: 20000)
</span></span><span style="display:flex;"><span>  opt.muzzy_decay_ms: 20000 (arenas.muzzy_decay_ms: 20000)
</span></span><span style="display:flex;"><span>  opt.lg_extent_max_active_fit: 6
</span></span><span style="display:flex;"><span>  opt.junk: &#34;false&#34;
</span></span><span style="display:flex;"><span>  opt.zero: false
</span></span><span style="display:flex;"><span>  opt.experimental_infallible_new: false
</span></span><span style="display:flex;"><span>  opt.tcache: true
</span></span><span style="display:flex;"><span>  opt.tcache_max: 32768
</span></span><span style="display:flex;"><span>  opt.tcache_nslots_small_min: 20
</span></span><span style="display:flex;"><span>  opt.tcache_nslots_small_max: 200
</span></span><span style="display:flex;"><span>  opt.tcache_nslots_large: 20
</span></span><span style="display:flex;"><span>  opt.lg_tcache_nslots_mul: 1
</span></span><span style="display:flex;"><span>  opt.tcache_gc_incr_bytes: 65536
</span></span><span style="display:flex;"><span>  opt.tcache_gc_delay_bytes: 0
</span></span><span style="display:flex;"><span>  opt.lg_tcache_flush_small_div: 1
</span></span><span style="display:flex;"><span>  opt.lg_tcache_flush_large_div: 1
</span></span><span style="display:flex;"><span>  opt.thp: &#34;default&#34;
</span></span><span style="display:flex;"><span>  opt.prof: false
</span></span><span style="display:flex;"><span>  opt.prof_prefix: &#34;jeprof&#34;
</span></span><span style="display:flex;"><span>  opt.prof_active: true (prof.active: false)
</span></span><span style="display:flex;"><span>  opt.prof_thread_active_init: true (prof.thread_active_init: false)
</span></span><span style="display:flex;"><span>  opt.lg_prof_sample: 19 (prof.lg_sample: 0)
</span></span><span style="display:flex;"><span>  opt.prof_accum: false
</span></span><span style="display:flex;"><span>  opt.lg_prof_interval: -1
</span></span><span style="display:flex;"><span>  opt.prof_gdump: false
</span></span><span style="display:flex;"><span>  opt.prof_final: false
</span></span><span style="display:flex;"><span>  opt.prof_leak: false
</span></span><span style="display:flex;"><span>  opt.prof_leak_error: false
</span></span><span style="display:flex;"><span>  opt.stats_print: false
</span></span><span style="display:flex;"><span>  opt.stats_print_opts: &#34;Jg&#34;
</span></span><span style="display:flex;"><span>  opt.stats_print: false
</span></span><span style="display:flex;"><span>  opt.stats_print_opts: &#34;Jg&#34;
</span></span><span style="display:flex;"><span>  opt.stats_interval: 256000000
</span></span><span style="display:flex;"><span>  opt.stats_interval_opts: &#34;&#34;
</span></span><span style="display:flex;"><span>  opt.zero_realloc: &#34;free&#34;
</span></span><span style="display:flex;"><span>Profiling settings
</span></span><span style="display:flex;"><span>  prof.thread_active_init: false
</span></span><span style="display:flex;"><span>  prof.active: false
</span></span><span style="display:flex;"><span>  prof.gdump: false
</span></span><span style="display:flex;"><span>  prof.interval: 0
</span></span><span style="display:flex;"><span>  prof.lg_sample: 0
</span></span><span style="display:flex;"><span>Arenas: 13
</span></span><span style="display:flex;"><span>Quantum size: 16
</span></span><span style="display:flex;"><span>Page size: 4096
</span></span><span style="display:flex;"><span>Maximum thread-cached size class: 32768
</span></span><span style="display:flex;"><span>Number of bin size classes: 36
</span></span><span style="display:flex;"><span>Number of thread-cache bin size classes: 41
</span></span><span style="display:flex;"><span>Number of large size classes: 196
</span></span></code></pre></div><h3 id="整体情况">
  整体情况
  <a class="anchor" href="#%e6%95%b4%e4%bd%93%e6%83%85%e5%86%b5">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Allocated: 13228376, active: 14700544, metadata: 6435696 (n_thp 0), resident: 23420928, mapped: 53010432, retained: 22487040
</span></span><span style="display:flex;"><span>Count of realloc(non-null-ptr, 0) calls: 0
</span></span><span style="display:flex;"><span>Background threads: 0, num_runs: 0, run_interval: 0 ns
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th style="text-align: center">字段</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">Allocated</td>
          <td>Total number of bytes allocated by the application.]()</td>
          <td>应用分配的字节数</td>
      </tr>
      <tr>
          <td style="text-align: center">active</td>
          <td>Total number of bytes in active pages allocated by the application.<!-- raw HTML omitted -->This is a multiple of the page size, and greater than or equal to <a href="https://jemalloc.net/jemalloc.3.html#stats.allocated"><code>stats.allocated</code></a>. <!-- raw HTML omitted -->This does not include <a href="https://jemalloc.net/jemalloc.3.html#stats.arenas.i.pdirty"><code>stats.arenas.&lt;i&gt;.pdirty</code></a>, <a href="https://jemalloc.net/jemalloc.3.html#stats.arenas.i.pmuzzy"><code>stats.arenas.&lt;i&gt;.pmuzzy</code></a>, nor pages entirely devoted to allocator metadata.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">metadata</td>
          <td>Total number of bytes dedicated to metadata,<!-- raw HTML omitted -->which comprise base allocations used for bootstrap-sensitive allocator metadata structures (see <a href="https://jemalloc.net/jemalloc.3.html#stats.arenas.i.base"><code>stats.arenas.&lt;i&gt;.base</code></a>) <!-- raw HTML omitted -->and internal allocations (see <a href="https://jemalloc.net/jemalloc.3.html#stats.arenas.i.internal"><code>stats.arenas.&lt;i&gt;.internal</code></a>). <!-- raw HTML omitted -->Transparent huge page (enabled with <a href="https://jemalloc.net/jemalloc.3.html#opt.metadata_thp">opt.metadata_thp</a>) usage is not considered.</td>
          <td>metadata占用的字节数</td>
      </tr>
      <tr>
          <td style="text-align: center">metadata_thp</td>
          <td>Number of transparent huge pages (THP) used for metadata.<!-- raw HTML omitted -->See <a href="https://jemalloc.net/jemalloc.3.html#stats.metadata"><code>stats.metadata</code></a> and <a href="https://jemalloc.net/jemalloc.3.html#opt.metadata_thp">opt.metadata_thp</a>) for details.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">resident</td>
          <td>Maximum number of bytes in physically resident data pages mapped by the allocator,<!-- raw HTML omitted -->comprising all pages dedicated to allocator metadata, pages backing active allocations, and unused dirty pages. <!-- raw HTML omitted -->This is a maximum rather than precise because pages may not actually be physically resident if they correspond to demand-zeroed virtual memory that has not yet been touched. <!-- raw HTML omitted -->This is a multiple of the page size, and is larger than <a href="https://jemalloc.net/jemalloc.3.html#stats.active"><code>stats.active</code></a>.</td>
          <td>物理驻留内存</td>
      </tr>
      <tr>
          <td style="text-align: center">mapped</td>
          <td>Total number of bytes in active extents mapped by the allocator.<!-- raw HTML omitted -->This is larger than <a href="https://jemalloc.net/jemalloc.3.html#stats.active"><code>stats.active</code></a>. <!-- raw HTML omitted -->This does not include inactive extents, even those that contain unused dirty pages, which means that there is no strict ordering between this and <a href="https://jemalloc.net/jemalloc.3.html#stats.resident"><code>stats.resident</code></a>.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">reatained</td>
          <td>Total number of bytes in virtual memory mappings that were retained rather than being returned to the operating system via e<a href="">.</a>g. <strong>munmap</strong>(2) or similar. <!-- raw HTML omitted -->Retained virtual memory is typically untouched, decommitted, or purged, so it has no strongly associated physical memory (see extent hooks for details). <!-- raw HTML omitted -->Retained memory is excluded from mapped memory statistics, e.g. <a href="https://jemalloc.net/jemalloc.3.html#stats.mapped"><code>stats.mapped</code></a>.</td>
          <td>未被使用但仍保留的字节数</td>
      </tr>
      <tr>
          <td style="text-align: center">zero_reallocs</td>
          <td>Number of times that the <code>realloc()</code> was called with a non-<code>NULL</code> pointer argument and a <code>0</code> size argument. <!-- raw HTML omitted -->This is a fundamentally unsafe pattern in portable programs; see <code>opt.zero_realloc</code> for details.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">background_thread.num_threads</td>
          <td>Number of background threads running currently.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">background_thread.num_runs</td>
          <td>Total number of runs from all background threads.</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: center">background_thread.run_interval</td>
          <td>Average run interval in nanoseconds of background threads.</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h4 id="mutex相关统计">
  mutex相关统计
  <a class="anchor" href="#mutex%e7%9b%b8%e5%85%b3%e7%bb%9f%e8%ae%a1">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                           n_lock_ops (#/sec)       n_waiting (#/sec)      n_spin_acq (#/sec)  n_owner_switch (#/sec)   total_wait_ns   (#/sec)     max_wait_ns  max_n_thds
</span></span><span style="display:flex;"><span>background_thread                 689       0               0       0               0       0              12       0               0         0               0           0
</span></span><span style="display:flex;"><span>max_per_bg_thd                      0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>ctl                          16288313   15053               0       0               0       0               1       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof                                0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof_thds_data                      0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof_dump                           0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof_recent_alloc                   0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof_recent_dump                    0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>prof_stats                          0       0               0       0               0       0               0       0               0         0               0           0
</span></span></code></pre></div><p>stats.mutexes.ctl.{counter}</p>
<h5 id="列">
  列
  <a class="anchor" href="#%e5%88%97">#</a>
</h5>
<p>Statistics on <code>ctl</code> mutex (global scope; mallctl related). <code>{counter}</code> is one of the counters below:</p>
<table>
  <thead>
      <tr>
          <th>指标</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>num_ops</code></td>
          <td>Total number of lock acquisition operations on this mutex.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>num_spin_acq</code></td>
          <td>Number of times the mutex was spin-acquired.<!-- raw HTML omitted -->When the mutex is currently locked and cannot be acquired immediately,<!-- raw HTML omitted -->a short period of spin-retry within jemalloc will be performed. <!-- raw HTML omitted -->Acquired through spin generally means the contention was lightweight and not causing context switches.</td>
          <td>spin等mutex的次数</td>
      </tr>
      <tr>
          <td><code>num_wait</code></td>
          <td>Number of times the mutex was wait-acquired,<!-- raw HTML omitted -->which means the mutex contention was not solved by spin-retry, <!-- raw HTML omitted -->and blocking operation was likely involved in order to acquire the mutex.<!-- raw HTML omitted -->This event generally implies higher cost / longer delay, and should be investigated if it happens often.</td>
          <td>wait等mutex的次数</td>
      </tr>
      <tr>
          <td><code>max_wait_time</code></td>
          <td>Maximum length of time in nanoseconds spent on a single wait-acquired lock operation.<!-- raw HTML omitted -->Note that to avoid profiling overhead on the common path, this does not consider spin-acquired cases.</td>
          <td>最长 wait等 时间</td>
      </tr>
      <tr>
          <td><code>total_wait_time</code></td>
          <td>Cumulative time in nanoseconds spent on wait-acquired lock operations. Similarly, spin-acquired cases are not considered.</td>
          <td>累计 wait等 时间</td>
      </tr>
      <tr>
          <td><code>max_num_thds</code></td>
          <td>Maximum number of threads waiting on this mutex simultaneously. Similarly, spin-acquired cases are not considered.</td>
          <td>最多同时等这个mutex的线程数</td>
      </tr>
      <tr>
          <td><code>num_owner_switch</code></td>
          <td>Number of times the current mutex owner is different from the previous one.<!-- raw HTML omitted -->This event does not generally imply an issue; rather it is an indicator of how often the protected data are accessed by different threads.</td>
          <td>mutex owner切换的次数</td>
      </tr>
  </tbody>
</table>
<h5 id="行">
  行
  <a class="anchor" href="#%e8%a1%8c">#</a>
</h5>
<p>不同的mutex</p>
<table>
  <thead>
      <tr>
          <th>mutex</th>
          <th>作用</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>background_thread</code></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td><code>prof</code></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td><code>prof_thds_data</code></td>
          <td><code>prof</code> threads data mutex</td>
          <td></td>
      </tr>
      <tr>
          <td><code>prof_dump</code></td>
          <td>prof dumping mutex</td>
          <td></td>
      </tr>
  </tbody>
</table>
<p>另外几个文档里没写</p>
<h3 id="arena-statistics">
  arena statistics
  <a class="anchor" href="#arena-statistics">#</a>
</h3>
<p>分为merged arena和各个arena；具体的内容是相同的；merged是其他的加总。</p>
<h4 id="整体">
  整体
  <a class="anchor" href="#%e6%95%b4%e4%bd%93">#</a>
</h4>
<h5 id="threads-uptime-dss">
  threads, uptime, dss
  <a class="anchor" href="#threads-uptime-dss">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Merged arenas stats:
</span></span><span style="display:flex;"><span>assigned threads: 12
</span></span><span style="display:flex;"><span>uptime: 1082888000000
</span></span><span style="display:flex;"><span>dss allocation precedence: &#34;N/A&#34;
</span></span></code></pre></div><ul>
<li>assigned threads：线程数</li>
<li>uptime：arena创建后的时间，ns</li>
<li>dss allocation precedence: 使用sbrk接口申请内存的优先权。一般更推荐用mmap。</li>
</ul>
<h5 id="dirty--muzzy-decay">
  dirty &amp; muzzy decay
  <a class="anchor" href="#dirty--muzzy-decay">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>decaying:  time       npages       sweeps     madvises       purged
</span></span><span style="display:flex;"><span>   dirty:   N/A          649          725         1238        13926
</span></span><span style="display:flex;"><span>   muzzy:   N/A            0          382          667         4219
</span></span></code></pre></div><ul>
<li>内存释放： dirty -(madvise(&hellip;, MADV_FREE))-&gt; muzzy -(madvise(&hellip;, MADV_DONTNEED))-&gt; clean</li>
<li>详见：<a href="https://github.com/jemalloc/jemalloc/issues/521" title="github">https://github.com/jemalloc/jemalloc/issues/521</a></li>
</ul>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>dirty_npurge</td>
          <td>Number of dirty page purge sweeps performed.</td>
          <td></td>
      </tr>
      <tr>
          <td>dirty_nmadvise</td>
          <td>Number of madvise() or similar calls made to purge dirty pages.</td>
          <td></td>
      </tr>
      <tr>
          <td>dirty_purged</td>
          <td>Number of dirty pages purged.</td>
          <td></td>
      </tr>
      <tr>
          <td>muzzy_npurge</td>
          <td>Number of muzzy page purge sweeps performed.</td>
          <td></td>
      </tr>
      <tr>
          <td>muzzy_nmadvise</td>
          <td>Number of madvise() or similar calls made to purge muzzy pages.</td>
          <td></td>
      </tr>
      <tr>
          <td>muzzy_purged</td>
          <td>Number of muzzy pages purged.</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h5 id="small--large--total">
  small &amp; large &amp; total
  <a class="anchor" href="#small--large--total">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                            allocated         nmalloc   (#/sec)         ndalloc   (#/sec)       nrequests   (#/sec)           nfill   (#/sec)          nflush   (#/sec)
</span></span><span style="display:flex;"><span>small:                        7117144          592932       547          555690       513        76036438     70273          286490       264          110463       102
</span></span><span style="display:flex;"><span>large:                        6111232          868287       802          868205       802          868323       802          868287       802              27         0
</span></span><span style="display:flex;"><span>total:                       13228376         1461219      1350         1423895      1315        76904761     71076         1154777      1067          110490       102
</span></span></code></pre></div><ul>
<li>small</li>
</ul>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>small.allocated</code></td>
          <td>Number of bytes currently allocated by small objects.</td>
          <td>当前分配的字节数</td>
      </tr>
      <tr>
          <td><code>small.nmalloc</code></td>
          <td>Cumulative number of times a small allocation was requested from the arena&rsquo;s bins,<!-- raw HTML omitted -->whether to fill the relevant tcache if <code>opt.tcache</code> is enabled, <!-- raw HTML omitted -->or to directly satisfy an allocation request otherwise.</td>
          <td>累计分配次数</td>
      </tr>
      <tr>
          <td><code>small.ndalloc</code></td>
          <td>Cumulative number of times a small allocation was returned to the arena&rsquo;s bins,<!-- raw HTML omitted -->whether to flush the relevant tcache if <code>opt.tcache</code> is enabled, <!-- raw HTML omitted -->or to directly deallocate an allocation otherwise.</td>
          <td>累计释放次数</td>
      </tr>
      <tr>
          <td><code>small.nrequests</code></td>
          <td>Cumulative number of allocation requests satisfied by all bin size classes.</td>
          <td>累计bin满足分配的次数</td>
      </tr>
      <tr>
          <td><code>small.nfills</code></td>
          <td>Cumulative number of tcache fills by all small size classes.</td>
          <td>累计tcache fill次数</td>
      </tr>
      <tr>
          <td><code>small.nflushes</code></td>
          <td>Cumulative number of tcache flushes by all small size classes.</td>
          <td>累计tcache flush次数</td>
      </tr>
  </tbody>
</table>
<ul>
<li>large</li>
</ul>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>large.allocated</code></td>
          <td>Number of bytes currently allocated by large objects.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>large.nmalloc</code></td>
          <td>Cumulative number of times a large extent was allocated from the arena,<!-- raw HTML omitted -->whether to fill the relevant tcache if <code>opt.tcache</code> is enabled and the size class is within the range being cached, <!-- raw HTML omitted -->or to directly satisfy an allocation request otherwise.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>large.ndalloc</code></td>
          <td>Cumulative number of times a large extent was returned to the arena,<!-- raw HTML omitted -->whether to flush the relevant tcache if <code>opt.tcache</code> is enabled and the size class is within the range being cached, <!-- raw HTML omitted -->or to directly deallocate an allocation otherwise.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>large.nrequests</code></td>
          <td>Cumulative number of allocation requests satisfied by all large size classes.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>large.nfills</code></td>
          <td>Cumulative number of tcache fills by all large size classes.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>large.nflushes</code></td>
          <td>Cumulative number of tcache flushes by all large size classes.</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h5 id="其他信息">
  其他信息
  <a class="anchor" href="#%e5%85%b6%e4%bb%96%e4%bf%a1%e6%81%af">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mapped:                      53010432
</span></span><span style="display:flex;"><span>retained:                    22487040
</span></span><span style="display:flex;"><span>base:                         6026096
</span></span><span style="display:flex;"><span>internal:                      409600
</span></span><span style="display:flex;"><span>metadata_thp:                       0
</span></span><span style="display:flex;"><span>tcache_bytes:                 1893992
</span></span><span style="display:flex;"><span>tcache_stashed_bytes:               0
</span></span><span style="display:flex;"><span>resident:                    23420928
</span></span><span style="display:flex;"><span>abandoned_vm:                       0
</span></span><span style="display:flex;"><span>extent_avail:                      62
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>mapped</td>
          <td>Number of mapped bytes.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>retained</code></td>
          <td>Number of retained bytes. See <code>stats.retained</code> for details.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>base</code></td>
          <td>Number of bytes dedicated to bootstrap-sensitive allocator metadata structures.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>internal</code></td>
          <td>Number of bytes dedicated to internal allocations. Internal allocations differ from application-originated allocations in that they are for internal use, and that they are omitted from heap profiles.</td>
          <td></td>
      </tr>
      <tr>
          <td><code>metadata_thp</code></td>
          <td>Number of transparent huge pages (THP) used for metadata. See opt.metadata_thp for details.</td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td><code>resident</code></td>
          <td>Maximum number of bytes in physically resident data pages mapped by the arena,<!-- raw HTML omitted -->comprising all pages dedicated to allocator metadata, pages backing active allocations, and unused dirty pages. <!-- raw HTML omitted -->This is a maximum rather than precise because pages may not actually be physically resident <!-- raw HTML omitted -->if they correspond to demand-zeroed virtual memory that has not yet been touched. <!-- raw HTML omitted -->This is a multiple of the page size.</td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td><code>extent_avail</code></td>
          <td>Number of allocated (but unused) extent structs in this arena.</td>
          <td></td>
      </tr>
  </tbody>
</table>
<p><code>stats.arenas.&lt;i&gt;.pactive</code> <strong>(<strong>size_t</strong>)</strong> <code>r-</code>Number of pages in active extents.</p>
<p><code>stats.arenas.&lt;i&gt;.pdirty</code> <strong>(<strong>size_t</strong>)</strong> <code>r-</code>Number of pages within unused extents that are potentially dirty, and for which <code>madvise()</code> or similar has not been called. See <code>opt.dirty_decay_ms</code> for a description of dirty pages.</p>
<p><code>stats.arenas.&lt;i&gt;.pmuzzy</code> <strong>(<strong>size_t</strong>)</strong> <code>r-</code>Number of pages within unused extents that are muzzy. See <code>opt.muzzy_decay_ms</code> for a description of muzzy pages.</p>
<h4 id="mutex的情况">
  mutex的情况
  <a class="anchor" href="#mutex%e7%9a%84%e6%83%85%e5%86%b5">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                           n_lock_ops (#/sec)       n_waiting (#/sec)      n_spin_acq (#/sec)  n_owner_switch (#/sec)   total_wait_ns   (#/sec)     max_wait_ns  max_n_thds
</span></span><span style="display:flex;"><span>large                            2676       2               0       0               0       0              12       0               0         0               0           0
</span></span><span style="display:flex;"><span>extent_avail                  1408609    1301               0       0               0       0             294       0               0         0               0           0
</span></span><span style="display:flex;"><span>extents_dirty                 1769484    1635               0       0               5       0            1385       1               0         0               0           0
</span></span><span style="display:flex;"><span>extents_muzzy                    6840       6               0       0               0       0              66       0               0         0               0           0
</span></span><span style="display:flex;"><span>extents_retained                 4525       4               0       0               0       0              54       0               0         0               0           0
</span></span><span style="display:flex;"><span>decay_dirty                      6117       5               0       0               0       0             206       0               0         0               0           0
</span></span><span style="display:flex;"><span>decay_muzzy                      5774       5               0       0               0       0             206       0               0         0               0           0
</span></span><span style="display:flex;"><span>base                             6408       5               0       0               0       0              45       0               0         0               0           0
</span></span><span style="display:flex;"><span>tcache_list                      2690       2               0       0               0       0              24       0               0         0               0           0
</span></span><span style="display:flex;"><span>hpa_shard                           0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>hpa_shard_grow                      0       0               0       0               0       0               0       0               0         0               0           0
</span></span><span style="display:flex;"><span>hpa_sec                             0       0               0       0               0       0               0       0               0         0               0           0
</span></span></code></pre></div><h4 id="bins">
  bins
  <a class="anchor" href="#bins">#</a>
</h4>
<p><img src="http://localhost:1313/assets/image/2024-10-11-jemalloc%e5%88%86%e6%9e%90/1728960417810.png" alt="1728960417810" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bins:    size ind  allocated  nmalloc (#/sec)  ndalloc (#/sec)  nrequests (#/sec)  nshards  curregs curslabs  nonfull_slabs regs pgs   util   nfills (#/sec) nflushes (#/sec)   nslabs nreslabs (#/sec)  n_lock_ops (#/sec)   n_waiting (#/sec)  n_spin_acq (#/sec)  n_owner_switch (#/sec)   total_wait_ns   (#/sec)   max_wait_ns  max_n_thds
</span></span><span style="display:flex;"><span>            8   0      17512   175799     162   173610     160   12313401   11380        1     2189        9              0  512   1  0.475   158539     146    15842      14        9    18914      17      177067     163           0       0           0       0              44       0               0         0             0           0
</span></span><span style="display:flex;"><span>           16   1     102096    35086      32    28705      26    6984984    6455        1     6381       29              1  256   1  0.859    21296      19    11101      10       29    24794      22       35104      32           0       0           0       0              63       0               0         0             0           0
</span></span><span style="display:flex;"><span>           32   2     334848    45359      41    34895      32   11337157   10477        1    10464       93             16  128   1  0.879    16142      14    13303      12      164    11617      10       32287      29           0       0           0       0              67       0               0         0             0           0
</span></span><span style="display:flex;"><span>           48   3     376608    20279      18    12433      11    1490700    1377        1     7846       37              6  256   3  0.828     1394       1     1087       1       65      352       0        5224       4           0       0           0       0             147       0               0         0             0           0
</span></span><span style="display:flex;"><span>           64   4     426240    16417      15     9757       9   11855396   10956        1     6660      108              4   64   1  0.963     7413       6     5865       5      116     2163       1       16071      14           0       0           0       0              52       0               0         0             0           0
</span></span><span style="display:flex;"><span>           80   5      48720    11422      10    10813       9     187963     173        1      609        8              1  256   5  0.297     8581       7     2233       2       15        5       0       13525      12           0       0           0       0             154       0               0         0             0           0
</span></span><span style="display:flex;"><span>           96   6      23232     9390       8     9148       8     161364     149        1      242        6              1  128   3  0.315     4917       4     4526       4        6        1       0       12126      11           0       0           0       0              35       0               0         0             0           0
</span></span><span style="display:flex;"><span>          112   7      11760     7292       6     7187       6      32461      30        1      105        3              0  256   7  0.136     6783       6     2145       1     1083        0       0       12688      11           0       0           0       0              28       0               0         0             0           0
</span></span><span style="display:flex;"><span>          128   8      19456     2900       2     2748       2    9215219    8516        1      152        8              1   32   1  0.593     1353       1     1298       1      568     1193       1        5969       5           0       0           0       0             395       0               0         0             0           0
</span></span><span style="display:flex;"><span>          160   9      60480     2424       2     2046       1      26904      24        1      378        6              0  128   5  0.492     1245       1     1212       1        6        0       0        5246       4           0       0           0       0             534       0               0         0             0           0
</span></span><span style="display:flex;"><span>          192  10      13056     2259       2     2191       2      35045      32        1       68        3              0   64   3  0.354     1999       1     2011       1     1999        0       0        8686       8           0       0           0       0              48       0               0         0             0           0
</span></span><span style="display:flex;"><span>          224  11      22848     1527       1     1425       1       7140       6        1      102        3              0  128   7  0.265     1101       1     1111       1       20        0       0        4909       4           0       0           0       0              65       0               0         0             0           0
</span></span><span style="display:flex;"><span>          256  12      17152      165       0       98       0    7923492    7323        1       67        6              1   16   1  0.697       32       0       35       0        9        2       0        2753       2           0       0           0       0              26       0               0         0             0           0
</span></span><span style="display:flex;"><span>          320  13      99520    33065      30    32754      30      88019      81        1      311        7              2   64   5  0.694     7715       7     8045       7      102     1007       0       18861      17           0       0           0       0            1138       1               0         0             0           0
</span></span><span style="display:flex;"><span>          384  14      84096   178530     165   178311     164     512638     473        1      219       11              3   32   3  0.622    14274      13    17382      16     1275    11082      10       38734      35           0       0           0       0            3552       3               0         0             0           0
</span></span><span style="display:flex;"><span>          448  15      57792     1785       1     1656       1       6864       6        1      129        3              0   64   7  0.671     1414       1     1121       1     1098        0       0        6310       5           0       0           0       0              55       0               0         0             0           0
</span></span><span style="display:flex;"><span>          512  16      20480      613       0      573       0    6293733    5816        1       40        8              1    8   1  0.625      554       0      554       0       11        2       0        3796       3           0       0           0       0              17       0               0         0             0           0
</span></span><span style="display:flex;"><span>          640  17      51840    21482      19    21401      19     199068     183        1       81        6              0   32   5  0.421    15049      13     4701       4       21        0       0       22449      20           0       0           0       0              60       0               0         0             0           0
</span></span><span style="display:flex;"><span>          768  18      39936     6868       6     6816       6      72130      66        1       52        5              0   16   3  0.650     4042       3     4222       3       14     2069       1       11136      10           0       0           0       0             772       0               0         0             0           0
</span></span><span style="display:flex;"><span>          896  19      28672     1398       1     1366       1       2471       2        1       32        1              0   32   7      1     1227       1     1017       0      990        0       0        5913       5           0       0           0       0              25       0               0         0             0           0
</span></span><span style="display:flex;"><span>         1024  20      57344     5431       5     5375       4    4743775    4384        1       56       17              2    4   1  0.823     1084       1     1373       1      716     2004       1        6143       5           0       0           0       0             953       0               0         0             0           0
</span></span><span style="display:flex;"><span>         1280  21      67840     1560       1     1507       1       3114       2        1       53        5              2   16   5  0.662     1414       1     1172       1     1088        2       0        6351       5           0       0           0       0              27       0               0         0             0           0
</span></span><span style="display:flex;"><span>         1536  22      19968      548       0      535       0        580       0        1       13        4              0    8   3  0.406      474       0      445       0      445        3       0        4041       3           0       0           0       0              20       0               0         0             0           0
</span></span><span style="display:flex;"><span>         1792  23      59136      666       0      633       0        695       0        1       33        3              0   16   7  0.687      582       0      585       0      582        0       0        4426       4           0       0           0       0              18       0               0         0             0           0
</span></span><span style="display:flex;"><span>         2048  24      69632     3086       2     3052       2    1258618    1163        1       34       18              0    2   1  0.944     1956       1     1956       1     1977     1082       1        8566       7           0       0           0       0              17       0               0         0             0           0
</span></span><span style="display:flex;"><span>         2560  25      81920     1153       1     1121       1       1673       1        1       32        7              0    8   5  0.571     1088       1     1089       1       12        3       0        4866       4           0       0           0       0              25       0               0         0             0           0
</span></span><span style="display:flex;"><span>         3072  26      73728      222       0      198       0        138       0        1       24        7              1    4   3  0.857       79       0       80       0       92        4       0        2928       2           0       0           0       0              15       0               0         0             0           0
</span></span><span style="display:flex;"><span>         3584  27      43008       46       0       34       0         11       0        1       12        4              0    8   7  0.375       11       0       13       0        6        2       0        2707       2           0       0           0       0              17       0               0         0             0           0
</span></span><span style="display:flex;"><span>         4096  28      90112      898       0      876       0    1269096    1172        1       22       22              0    1   1      1      861       0      862       0      898        0       0        5298       4           0       0           0       0              17       0               0         0             0           0
</span></span><span style="display:flex;"><span>         5120  29    3758080     3945       3     3211       2      10905      10        1      734      184              1    4   5  0.997     2753       2     2949       2      229     2884       2        8608       7           0       0           0       0              22       0               0         0             0           0
</span></span><span style="display:flex;"><span>         6144  30      61440       30       0       20       0          4       0        1       10        5              0    2   3      1        3       0        5       0       15        2       0        2700       2           0       0           0       0              15       0               0         0             0           0
</span></span><span style="display:flex;"><span>         7168  31     143360       20       0        0       0          0       0        1       20        6              0    4   7  0.833        2       0        1       0        6        0       0        2686       2           0       0           0       0              15       0               0         0             0           0
</span></span><span style="display:flex;"><span>         8192  32     253952     1157       1     1126       1       1606       1        1       31       31              0    1   2      1     1090       1     1092       1     1157        0       0        6016       5           0       0           0       0              21       0               0         0             0           0
</span></span><span style="display:flex;"><span>        10240  33     215040       70       0       49       0         70       0        1       21       12              1    2   5  0.875       19       0       24       0       32       11       0        2752       2           0       0           0       0              23       0               0         0             0           0
</span></span><span style="display:flex;"><span>        12288  34     122880       30       0       20       0          4       0        1       10       10              0    1   3      1        3       0        5       0       30        0       0        2715       2           0       0           0       0              15       0               0         0             0           0
</span></span><span style="display:flex;"><span>        14336  35     143360       10       0        0       0          0       0        1       10        5              0    2   7      1        1       0        1       0        5        0       0        2684       2           0       0           0       0              14       0               0         0             0           0
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th></th>
          <th>数据</th>
          <th>数据</th>
          <th>&hellip;</th>
          <th>数据</th>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>size</td>
          <td>8</td>
          <td>16</td>
          <td></td>
          <td>14336</td>
          <td></td>
          <td></td>
          <td>大小</td>
      </tr>
      <tr>
          <td>ind</td>
          <td>0</td>
          <td>1</td>
          <td></td>
          <td>35</td>
          <td></td>
          <td></td>
          <td>index</td>
      </tr>
      <tr>
          <td>allocated</td>
          <td>17512</td>
          <td>102096</td>
          <td></td>
          <td>143360</td>
          <td></td>
          <td></td>
          <td>当前分配的字节数</td>
      </tr>
      <tr>
          <td>nmalloc (#/sec)</td>
          <td>175799 (162)</td>
          <td>35086 (32)</td>
          <td></td>
          <td>10 (0)</td>
          <td><code>bins.&lt;j&gt;.nmalloc</code></td>
          <td>Cumulative number of times a bin region of the corresponding size class was allocated from the arena,<!-- raw HTML omitted -->whether to fill the relevant tcache if <code>opt.tcache</code> is enabled, or to directly satisfy an allocation request otherwise.</td>
          <td>累计分配个数</td>
      </tr>
      <tr>
          <td>ndalloc (#/sec)</td>
          <td>173610 (160)</td>
          <td>28705 (26)</td>
          <td></td>
          <td>0 (0)</td>
          <td><code>bins.&lt;j&gt;.ndalloc</code></td>
          <td>Cumulative number of times a bin region of the corresponding size class was returned to the arena,<!-- raw HTML omitted -->whether to flush the relevant tcache if <code>opt.tcache</code> is enabled, or to directly deallocate an allocation otherwise.</td>
          <td>累计释放个数</td>
      </tr>
      <tr>
          <td>nrequests (#/sec)</td>
          <td>12313401 (11380)</td>
          <td>6984984 (6455)</td>
          <td></td>
          <td>0 (0)</td>
          <td><code>bins.&lt;j&gt;.nrequests</code></td>
          <td>Cumulative number of allocation requests satisfied by bin regions of the corresponding size class.</td>
          <td></td>
      </tr>
      <tr>
          <td>nshards</td>
          <td>1</td>
          <td>1</td>
          <td></td>
          <td>1</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>curregs</td>
          <td>2189</td>
          <td>6381</td>
          <td></td>
          <td>10 (0)</td>
          <td><code>bins.&lt;j&gt;.curregs</code></td>
          <td>Current number of regions for this size class.</td>
          <td>当前使用个数</td>
      </tr>
      <tr>
          <td>curslabs</td>
          <td>9</td>
          <td>29</td>
          <td></td>
          <td>5</td>
          <td><code>bins.&lt;j&gt;.curslabs</code></td>
          <td>Current number of slabs.</td>
          <td>当前slab数</td>
      </tr>
      <tr>
          <td>nonfull_slabs</td>
          <td>0</td>
          <td>1</td>
          <td></td>
          <td>0</td>
          <td><code>bins.&lt;j&gt;.nonfull_slabs</code></td>
          <td>Current number of nonfull slabs.</td>
          <td>当前空闲slab数</td>
      </tr>
      <tr>
          <td>regs</td>
          <td>512</td>
          <td>256</td>
          <td></td>
          <td>2</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>pgs</td>
          <td>1</td>
          <td>1</td>
          <td></td>
          <td>7</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>util</td>
          <td>0.475</td>
          <td>0.859</td>
          <td></td>
          <td>1</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>nfills (#/sec)</td>
          <td>158539 (146)</td>
          <td>21296 (19)</td>
          <td></td>
          <td>1 (0)</td>
          <td><code>bins.&lt;j&gt;.nfills</code></td>
          <td>Cumulative number of tcache fills.</td>
          <td></td>
      </tr>
      <tr>
          <td>nflushes (#/sec)</td>
          <td>15842 (14)</td>
          <td>11101 (10)</td>
          <td></td>
          <td>1 (0)</td>
          <td><code>bins.&lt;j&gt;.nflushes</code></td>
          <td>Cumulative number of tcache flushes.</td>
          <td></td>
      </tr>
      <tr>
          <td>nslabs</td>
          <td>9</td>
          <td>29</td>
          <td></td>
          <td>5</td>
          <td><code>bins.&lt;j&gt;.nslabs</code></td>
          <td>Cumulative number of slabs created.</td>
          <td></td>
      </tr>
      <tr>
          <td>nreslabs (#/sec)</td>
          <td>18914 (17)</td>
          <td>24794 (22)</td>
          <td></td>
          <td>0 (0)</td>
          <td><code>bins.&lt;j&gt;.nreslabs</code></td>
          <td>Cumulative number of times the current slab from which to allocate changed.</td>
          <td></td>
      </tr>
      <tr>
          <td>n_lock_ops (#/sec)</td>
          <td>177067 (163)</td>
          <td>35104 (32)</td>
          <td></td>
          <td>2684 (2)</td>
          <td><code>bins.&lt;j&gt;.mutex.{counter}</code></td>
          <td>Statistics on <code>arena.&lt;i&gt;.bins.&lt;j&gt;</code> mutex (arena bin scope; bin operation related). <!-- raw HTML omitted --><code>{counter}</code> is one of the counters in mutex profiling counters.</td>
          <td></td>
      </tr>
      <tr>
          <td>n_waiting (#/sec)</td>
          <td>0 (0)</td>
          <td>0 (0)</td>
          <td></td>
          <td>0 (0)</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>n_spin_acq (#/sec)</td>
          <td>0 (0)</td>
          <td>0 (0)</td>
          <td></td>
          <td>0 (0)</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>n_owner_switch (#/sec)</td>
          <td>44 (0)</td>
          <td>63 (0)</td>
          <td></td>
          <td>14 (0)</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>total_wait_ns   (#/sec)</td>
          <td>0 (0)</td>
          <td>0 (0)</td>
          <td></td>
          <td>0 (0)</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>max_wait_ns</td>
          <td>0</td>
          <td>0</td>
          <td></td>
          <td>0</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>max_n_thds</td>
          <td>0</td>
          <td>0</td>
          <td></td>
          <td>0</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<p>逐bin的small数据统计，以及bin中mutex的各类操作统计</p>
<p>有一些数据的含义文档中没写。</p>
<h4 id="large">
  large
  <a class="anchor" href="#large">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>large:          size ind    allocated      nmalloc (#/sec)      ndalloc (#/sec)    nrequests (#/sec)  curlextents
</span></span><span style="display:flex;"><span>               16384  36        32768            3       0            1       0            3       0            2
</span></span><span style="display:flex;"><span>               20480  37       389120           33       0           14       0           60       0           19
</span></span><span style="display:flex;"><span>               24576  38            0            1       0            1       0            1       0            0
</span></span><span style="display:flex;"><span>               28672  39       430080           17       0            2       0           17       0           15
</span></span><span style="display:flex;"><span>               32768  40        65536            5       0            3       0           14       0            2
</span></span><span style="display:flex;"><span>               40960  41       696320       867943     802       867926     802       867943     802           17
</span></span><span style="display:flex;"><span>               49152  42        49152            2       0            1       0            2       0            1
</span></span><span style="display:flex;"><span>               57344  43        57344            1       0            0       0            1       0            1
</span></span><span style="display:flex;"><span>               65536  44       196608          224       0          221       0          224       0            3
</span></span><span style="display:flex;"><span>               81920  45       983040           29       0           17       0           29       0           12
</span></span><span style="display:flex;"><span>               98304  46            0            1       0            1       0            1       0            0
</span></span><span style="display:flex;"><span>              114688  47            0            8       0            8       0            8       0            0
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>              163840  49      1310720           11       0            3       0           11       0            8
</span></span><span style="display:flex;"><span>              196608  50            0            1       0            1       0            1       0            0
</span></span><span style="display:flex;"><span>              229376  51            0            4       0            4       0            4       0            0
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>              327680  53       327680            1       0            0       0            1       0            1
</span></span><span style="display:flex;"><span>              393216  54            0            1       0            1       0            1       0            0
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>              786432  58            0            1       0            1       0            1       0            0
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>             1572864  62      1572864            1       0            0       0            1       0            1
</span></span><span style="display:flex;"><span>                     ---
</span></span></code></pre></div><p><code>stats.arenas.&lt;i&gt;.lextents.&lt;j&gt;.curlextents</code></p>
<p>Current number of large allocations for this size class.</p>
<h4 id="extents">
  extents
  <a class="anchor" href="#extents">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>extents:        size ind       ndirty        dirty       nmuzzy        muzzy    nretained     retained       ntotal        total
</span></span><span style="display:flex;"><span>                4096   0           25       102400            0            0           14        57344           39       159744
</span></span><span style="display:flex;"><span>                8192   1           31       253952            0            0           19       155648           50       409600
</span></span><span style="display:flex;"><span>               12288   2           32       393216            0            0            9       110592           41       503808
</span></span><span style="display:flex;"><span>               16384   3            1        16384            0            0            4        65536            5        81920
</span></span><span style="display:flex;"><span>               20480   4            2        40960            0            0            3        61440            5       102400
</span></span><span style="display:flex;"><span>               24576   5            3        73728            0            0            4        98304            7       172032
</span></span><span style="display:flex;"><span>               28672   6            0            0            0            0            1        28672            1        28672
</span></span><span style="display:flex;"><span>               32768   7            1        32768            0            0            1        32768            2        65536
</span></span><span style="display:flex;"><span>               40960   8            1        40960            0            0            0            0            1        40960
</span></span><span style="display:flex;"><span>               49152   9            0            0            0            0            2        90112            2        90112
</span></span><span style="display:flex;"><span>               57344  10            0            0            0            0            1        53248            1        53248
</span></span><span style="display:flex;"><span>               65536  11            1        65536            0            0            1        65536            2       131072
</span></span><span style="display:flex;"><span>               81920  12            2       159744            0            0            0            0            2       159744
</span></span><span style="display:flex;"><span>               98304  13            2       192512            0            0            0            0            2       192512
</span></span><span style="display:flex;"><span>              114688  14            1       106496            0            0            0            0            1       106496
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>              163840  16            0            0            0            0            1       139264            1       139264
</span></span><span style="display:flex;"><span>              196608  17            0            0            0            0            1       192512            1       192512
</span></span><span style="display:flex;"><span>              229376  18            1       200704            0            0            0            0            1       200704
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>              327680  20            0            0            0            0            1       311296            1       311296
</span></span><span style="display:flex;"><span>                     ---
</span></span><span style="display:flex;"><span>             1048576  27            1       978944            0            0            0            0            1       978944
</span></span><span style="display:flex;"><span>             1310720  28            0            0            0            0            1      1167360            1      1167360
</span></span><span style="display:flex;"><span>             1572864  29            0            0            0            0            1      1445888            1      1445888
</span></span><span style="display:flex;"><span>             1835008  30            0            0            0            0            2      3493888            2      3493888
</span></span><span style="display:flex;"><span>             2097152  31            0            0            0            0            6     12496896            6     12496896
</span></span><span style="display:flex;"><span>             2621440  32            0            0            0            0            1      2420736            1      2420736
</span></span><span style="display:flex;"><span>                     ---
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th>参数</th>
          <th>含义</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>size</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>ind</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>ndirty</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>dirty</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>nmuzzy</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>muzzy</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>nretained</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>retained</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>ntotal</td>
          <td>ndirty + nmuzzy + nretained</td>
          <td></td>
      </tr>
      <tr>
          <td>total</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<h4 id="其他">
  其他
  <a class="anchor" href="#%e5%85%b6%e4%bb%96">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Bytes in small extent cache: 0
</span></span><span style="display:flex;"><span>HPA shard stats:
</span></span><span style="display:flex;"><span>  Purge passes: 0 (0 / sec)
</span></span><span style="display:flex;"><span>  Purges: 0 (0 / sec)
</span></span><span style="display:flex;"><span>  Hugeifies: 0 (0 / sec)
</span></span><span style="display:flex;"><span>  Dehugifies: 0 (0 / sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  In full slabs:
</span></span><span style="display:flex;"><span>      npageslabs: 0 huge, 0 nonhuge
</span></span><span style="display:flex;"><span>      nactive: 0 huge, 0 nonhuge 
</span></span><span style="display:flex;"><span>      ndirty: 0 huge, 0 nonhuge
</span></span><span style="display:flex;"><span>      nretained: 0 huge, 0 nonhuge 
</span></span><span style="display:flex;"><span>  In empty slabs:
</span></span><span style="display:flex;"><span>      npageslabs: 0 huge, 0 nonhuge
</span></span><span style="display:flex;"><span>      nactive: 0 huge, 0 nonhuge 
</span></span><span style="display:flex;"><span>      ndirty: 0 huge, 0 nonhuge
</span></span><span style="display:flex;"><span>      nretained: 0 huge, 0 nonhuge 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                size ind npageslabs_huge    nactive_huge     ndirty_huge  npageslabs_nonhuge     nactive_nonhuge      ndirty_nonhuge   nretained_nonhuge
</span></span><span style="display:flex;"><span>                     ---
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置方法">配置方法</a></li>
    <li><a href="#统计数据">统计数据</a>
      <ul>
        <li><a href="#配置信息">配置信息</a></li>
        <li><a href="#整体情况">整体情况</a></li>
        <li><a href="#arena-statistics">arena statistics</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












